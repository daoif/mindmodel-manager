# MindModel Manager - SDD v2 功能增强

> 基于 MVP 版本的使用体验增强

---

## 1. 概述

本文档记录 MVP 版本之后的功能增强需求，优先级按用户需求顺序排列。

### 1.1 语言规范

> [!IMPORTANT]
> 除代码外，所有内容均使用**中文**：
> - 文档（本文档、README等）
> - 代码注释
> - 界面 UI 文字
> - 提交信息

---

## 2. UI/UX 改进

### 2.1 组合条件搜索/筛选

**问题**：当前缺少搜索功能，无法快速定位模型。

**设计方案**：
- 在内容区顶部添加筛选栏
- 支持以下筛选方式：
  - **关键词搜索**：搜索模型名称、描述
  - **标签组筛选**：点击标签按钮自动筛选
  - **组合筛选**：多个条件 AND 关系

**UI 形态**：
```
┌─────────────────────────────────────────────────────────────┐
│ 🔍 [搜索模型名称...]                                        │
├─────────────────────────────────────────────────────────────┤
│ 场景: [创业] [技术] [直播] [管理]   ← 点击切换选中状态       │
│ 阶段: [洞察] [决策] [执行]                                   │
│ 分类: [战略认知类] [问题拆解类] [沟通类] ...                 │
├─────────────────────────────────────────────────────────────┤
│ 已选: 场景:创业 × | 阶段:洞察 ×     [清除全部]              │
└─────────────────────────────────────────────────────────────┘
```

**交互逻辑**：
1. 默认不展开全部标签组，仅显示当前维度下有值的标签
2. 点击标签切换选中/取消
3. 多个维度之间为 AND 关系，同维度内为 OR 关系
4. 实时更新列表，无需手动触发

**筛选栏展开/收起**：
- **"全部"页面**：筛选栏默认展开显示
- **其他筛选页面**（如 场景>创业）：筛选栏默认收起，仅显示一个展开按钮（▼图标），点击后向下展开筛选栏
- 展开状态在当前会话内保持，刷新后恢复默认

---

### 2.2 "新建模型"按钮位置

**问题**：新建按钮在所有页面头部都显示，不够干净。

**改动**：
- 仅在"全部"页面（无筛选条件时）显示顶部新建按钮
- 或移至左下角固定位置（fab 风格）

---

### 2.3 标题栏样式优化

**问题**：
- "MindModel Manager" 显示为可点击样式，但无实际功能
- 位置偏右

**改动**：
- 移除 `cursor-pointer` 样式
- 左对齐，作为纯展示标题
- 简化 header，仅保留标题

---

### 2.4 模型计数显示

**需求**：显示当前筛选结果数量

**格式**：`YY/XX 个模型`
- XX = 当前分类/维度下的总模型数
- YY = 进一步筛选后的模型数

**示例**：
- 点击"场景 > 创业"后显示：`3/5 个模型`（共5个创业相关，其中3个满足其他筛选条件）

---

## 3. 视图增强

### 3.1 列表视图

**需求**：增加列表视图作为卡片视图的替代，提高信息密度。

**特性**：
- 表格形式展示：名称、描述（截断）、标签、更新时间
- 支持行内快速编辑：
  - 双击名称/描述直接编辑
  - 标签支持点击添加/删除
- 视图切换按钮（卡片/列表）

**UI 形态**：
```
┌──────────────────────────────────────────────────────────────────────────┐
│ [🔲 卡片] [≡ 列表]                     3/5 个模型                         │
├────────────────────────────────────────────────────────────────────────────┤
│ 名称          │ 描述             │ 标签              │ 更新时间  │ 操作   │
├────────────────────────────────────────────────────────────────────────────┤
│ 第一性原理    │ 打破固有认知...  │ [创业][洞察]      │ 2026-01-03│ ✏️ 🗑️ │
│ MECE拆分      │ 确保问题分析...  │ [通用][洞察]      │ 2026-01-03│ ✏️ 🗑️ │
│ GROW教练      │ 四步引导激发...  │ [直播][执行]      │ 2026-01-03│ ✏️ 🗑️ │
└────────────────────────────────────────────────────────────────────────────┘
```

**行内编辑规则**：
- 名称、描述：双击进入编辑模式，失焦自动保存
- 标签：点击显示下拉选择器
- 不支持行内编辑的字段：子文档内容（需打开模态框）

**默认视图设置**：
- **"全部"页面**：默认使用列表视图
- **其他筛选页面**：默认使用卡片视图
- 用户可通过切换按钮临时更改当前页面视图

**视图配置页面**：
- 新增设置页面 `/settings/view`
- 可配置各页面的默认视图（列表/卡片）
- 设置存储在 localStorage 或后端用户配置表

---

### 3.2 编辑模态框

**需求**：编辑页面改为模态框形式，不独占空间。

**改动**：
- 移除 `/model/new` 和 `/model/:id/edit` 路由页面
- 改为模态框组件 `<ModelEditModal>`
- 两种视图下统一使用模态框

**模态框内容**：
- 基础信息编辑（名称、描述、标签）
- Tab 切换子文档编辑
- 底部操作栏：保存、取消、删除

---

## 4. 筛选逻辑增强

### 4.1 多条件组合筛选

**问题**：当前只支持单个筛选条件（如 场景=创业），无法组合（场景=创业 AND 阶段=洞察）。

**改动**：
- 左侧导航树选择后，设置为"基础筛选"
- 顶部筛选栏为"附加筛选"，与基础筛选叠加
- 支持任意维度的组合

**筛选状态存储**：
```typescript
interface FilterState {
  // 基础筛选（来自左侧导航树）
  baseFilters: Array<{ dimension: string; value: string }>;
  // 附加筛选（来自顶部筛选栏）
  additionalFilters: Array<{ dimension: string; value: string }>;
  // 关键词
  keyword: string;
}
```

### 4.2 多层导航树

**需求**：左侧导航树支持超过2层的层级结构。

**示例**：
```
全部
├── 场景
│   ├── 创业
│   │   ├── 洞察
│   │   ├── 决策
│   │   └── 执行
│   └── 技术
│       └── ...
├── 阶段
│   └── ...
└── 分类
    └── ...
```

**实现方式**：导航树节点的 `rule` 改为数组，支持多条件。

---

### 4.3 "类型"字段处理

**需求**："类型"维度不在左侧导航树显示。

**原因**：类型（陪练/内化/产出）更适合作为顶部筛选器，而非分类导航。

**改动**：
- 后端 `/api/navigation` 排除 "类型" 维度
- "类型" 仅在顶部筛选栏可选

---

## 5. 配置与扩展

### 5.1 标签颜色配置

**需求**：不同维度的标签显示不同颜色，便于视觉区分。

**设计**：
| 维度 | 颜色示例 |
|-----|---------|
| 场景 | 蓝色系 `bg-blue-100 text-blue-800` |
| 阶段 | 绿色系 `bg-green-100 text-green-800` |
| 类型 | 紫色系 `bg-purple-100 text-purple-800` |
| 分类 | 橙色系 `bg-orange-100 text-orange-800` |

**存储**：在 `tag_dimensions` 表增加 `color` 字段。

---

### 5.2 字段可配置化

**需求**：标签维度和子文档类型可通过管理页面动态配置。

**管理页面功能**：
- 查看当前所有维度/类型
- 添加新维度/类型
- 编辑名称、排序、颜色
- 删除（需确认，有关联数据时提示）

**新增路由**：
| 页面 | 路径 | 功能 |
|-----|------|------|
| 维度管理 | `/settings/dimensions` | 管理标签维度 |
| 文档类型管理 | `/settings/doc-types` | 管理子文档类型 |

**新增 API**：
| 方法 | 路径 | 描述 |
|-----|------|------|
| PUT | `/api/config/tag-dimensions/:name` | 更新维度配置 |
| DELETE | `/api/config/tag-dimensions/:name` | 删除维度 |
| PUT | `/api/config/doc-types/:name` | 更新文档类型 |
| DELETE | `/api/config/doc-types/:name` | 删除文档类型 |

---

## 6. 补充建议

基于以上需求，我建议额外考虑：

### 6.1 键盘快捷键
- `Ctrl+K` 或 `/`：快速搜索
- `Esc`：关闭模态框
- `Ctrl+N`：新建模型

### 6.2 批量操作
- 列表视图支持多选
- 批量删除、批量添加标签

### 6.3 数据导入/导出
- 导出为 JSON
- 从初始材料批量导入

---

## 7. 实施优先级建议

| 优先级 | 功能 | 工作量 |
|-------|------|-------|
| P0 | 2.3 标题栏样式优化 | 小 |
| P0 | 4.3 "类型"从导航移除 | 小 |
| P1 | 2.1 组合条件筛选 | 中 |
| P1 | 2.4 模型计数 | 小 |
| P1 | 3.2 编辑模态框 | 中 |
| P2 | 3.1 列表视图 | 中 |
| P2 | 5.1 标签颜色 | 小 |
| P2 | 4.1/4.2 多条件+多层导航 | 大 |
| P3 | 5.2 配置管理页面 | 中 |

